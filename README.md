# 편의점

# 🏪 웹 기반 편의점 결제 시스템

## 📌 프로젝트 개요

우테코 프리코스 7기에서 진행했던 **콘솔 기반 편의점 미션을 웹 환경에서 재정의 및 발전시킨 프로젝트**입니다.

기존 콘솔 프로그램의 한계를 넘어, 실제 웹 환경에서 동작하는 시스템을 구현해 제공하는 것을 목표로 했습니다.

사용자는 웹 UI에서 상품을 선택하고, 프로모션과 멤버십 할인 정책이 반영된 결제를 진행하며, 구매 내역은 영수증 UI 형태로 확인할 수 있습니다.

또한 모든 재고는 데이터베이스와 연동되어 실시간으로 업데이트됩니다.

---

# 📌 구현 기능

## 1. 상품 관리 및 재고 반영

- 모든 상품 정보는 데이터베이스에서 관리된다.
- 웹 장바구니 UI에서 담을 수 있는 양은 “현재 재고 수량”을 기준으로 제한된다.
  - 실제와 같이 장바구니에서 제거하는 기능도 만든다.
- 결제 완료 시 구매 수량만큼 재고를 즉시 차감한다.
- 결제 후 “계속 이용하기”를 누르면 추가적으로 편의점을 이용할 수 있다.

---

## 🎁 2. 프로모션 할인 적용

- 프로모션은 **`N개 구매 시 1개 증정`** 구조로 동작한다.
  - 예: `1+1 → 1개 구매 시 1개 무료`, `2+1 → 2개 구매 시 1개 무료`
- **동일 상품에는 단 하나의 프로모션만 적용**된다.
- **오늘 날짜가 프로모션 기간 내**여야만 적용된다.
  - 예: `2025-11-01 ~ 2025-12-31` 이내일 때만 적용
- 프로모션은 **상품 단위로 개별 적용**된다.

  즉, 같은 콜라라도 A 콜라는 1+1, B 콜라는 2+1처럼 각각 다르게 적용될 수 있다.

### 🛒 1. 프로모션 누락 안내

사용자가 프로모션 상품을 기준 수량보다 적게 담았을 때 안내하는 로직이다.

#### ✔ 어떤 상황에서 발생하나?

- `1+1` 상품을 1개만 담음
- `2+1` 상품을 2개만 담음
- `2+1` 상품을 5개 담음 → 3개까지 프로모션 적용하고 나머지 2개에 대한 **증정품** **1개 부족**

#### ✔ 항상 “부족한 수량은 1개”로 고정

프로모션 구조 특성상
```
- 1+1 → 2개 사이클
- 2+1 → 3개 사이클
```
이기 때문에 1개만 부족한 형태로 떨어진다.

#### ✔ 사용자에게 안내해야 하는 정보

- 어떤 상품의 프로모션이 누락되었는가?
- 어떤 프로모션인가(1+1인지, 2+1인지)?
- 추가로 담아올 것이면 하나를 장바구니에 추가하고 안하면 그대로 결제가 진행됨 알린다.

### ✔ 실제 예시
| 상황                 | 설명                                          |
|--------------------|---------------------------------------------|
| 콜라 (2+1) 2개 담음     | 2개만 담아 무료 1개 받을 수 있는 조건이 충족되지 않음.           |
| 주스 (1+1) 5개 담음     | 2개 사이클 -> 4개까지 적용, 나머지 1개에 대한 증정품 제공 가능.    |
| 비타민워터 (2+1) 11개 담음 | 3개 사이클 -> 9개까지 적용, 나머지 2개에 대한 1개 증정품 제공 가능. |
 

### 🚫 2. 프로모션 재고 부족 안내

프로모션 상품 누락으로 인해 원래하면 바로 위 누락에 대한 안내 메시지를 제공해야 한다.
**재고 때문에 증정품 수량을 줄 수 없는 경우 재고 부족에 대한 안내를 제공한다.**

#### ✔ 어떤 상황에서 발생하나?

- 1+1 상품을 1개 담았지만 그 1개가 마지막 재고인 경우.
- 2+1 상품을 2개 담았지만 그 2개가 마지막 재고인 경우.
- 2+1 상품을 11개 담았지만 재고 소진으로 9개까지는 적용되고 나머지 2개에 대한 프로모션 적용이 안되는 경우

#### ✔ 어떤 선택지가 필요하나?

사용자는 상황을 보고 아래 중 하나를 선택해야 한다:

- **무시하고 결제 진행 (증정품 없이 그냥 결제를 수행)**
- **결제를 취소하여 장바구니에 담긴 시점으로 되돌아가기**

### ✔ 실제 예시
| 상황 | 재고 | 담은 수량 | 설명 |
| --- | --- | --- | --- |
| 콜라 (2+1) | 재고 2 | 사용자 담은 수량 2 | 증정품(1개)을 줄 재고가 없음 → 프로모션 미적용 |
| 주스 (1+1) | 재고 5 | 사용자 담은 수량 5 | 4개까진 적용, 나머지 1개에 대한 증정품이 재고가 없어 미적용 |
| 비타민워터 (2+1) | 재고 11 | 사용자 담은 수량 11 | 9개까진 적용, 나머지 2개에 대한 증정품 재고가 없어 미적용 |


## 💳 3. 멤버십 할인

멤버십 할인은 프로모션 적용 후 남은 정가 구매 상품에 대해 추가로 적용되는 할인이다.
"할인 안내 → 사용자 선택 → 최종 결제"의 구조로 이루어진다.

### ✔ 멤버십 할인 규칙

- **프로모션이 없는 상품**들에 한하여 적용된다. 
- 총액의 **10%**가 할인된다.
- 만약 총 구매액의 10%가 10000원을 초과한다면 10000원까지만 할인이 적용된다.
- 사용자가 "예 / 아니오"로 직접 선택해서 고른다.

### ✔ 실제 예시
  | 상품    | 프로모션 | 구매 갯수 | 적용 여부    |
  |-------|----|------| -------- |
  | 주스    | 1+1 | 4개   | ❌ 제외     |
  | 콜라    | 2+1 | 1개   | ❌ 제외     |
  | 삼다수   | 없음 | 3개   | ⭕ 멤버십 적용 |

## 4. 결제 흐름 체크

 - 사용가 결제를 시도하면 그 **중간 이슈**를 단계적으로 확인한 뒤, 모든 조건이 충족되었을 때 최종적으로
  결제가 진행된다. **프로모션 누락 → 프로모션 재고 부족 → 멤버십 적용** 순으로 이루어진다. 이 흐름은
  **프론트 → 서버 → 프론트 → 서버 간의 인터랙션 구조**로 동작한다.

### 1. 실제 흐름
  - **프로모션 증정품이 누락된 상태**에서 아직 선택을 받지 않은 초기 상태의 경우.
  - **프로모션 증정품이 누락된 상태 + 재고 고갈**에 대해 아직 선택을 받지 않은 초기 상태의 경우.
    - 위 2가지 모두 **null 처리 → 결제 중단 pay() 전체를 롤백 -> 409 응답으로 안내 메시지 반환**.

  - 위 **2가지가 모두 해결됐을 경우**에 멤버십 선택을 받지 않은 상태의 경우.
    - **null 처리 → 결제 중단 pay() 전체를 롤백 -> 409 응답으로 멤버십 적용 안내 메시지 반환**.

### 2. 예시 플로우 차트
```
==================== 결제 예시 플로우 차트 ====================

[0] 초기 장바구니 상태
    - 콜라 2개 (2+1 프로모션)
    - 주스 9개 (1+1 프로모션)

        │
        ▼

[1] 결제 요청(Pay) 발생
        │
        ▼

[2] 프로모션 누락 이슈 발생
    - 예: 콜라 2개만 담음 → (2+1 조건 충족 X → 1개 부족)
        │
        ├─ 사용자가 선택하지 않음 → 서버가 409 메시지 반환(롤백)
        │
        └─ 사용자가 선택 후 다시 결제 요청(Pay 재요청)
                │
                ▼

[3] 프로모션 재고 부족 이슈 발생
    - 예: 주스 9개 구매 → 증정품 지급 불가
        │
        ├─ ❌ 사용자 선택: 취소 ->(되돌아감) 장바구니에 담긴 [0]번 상태로 복귀
        │       │
        │       └───────▶ 취소(단, 2번에서 콜라를 담기를 눌렀다면 콜라는 3개로 바뀐 상태를 적용함)
        │
        └─ ⭕ 사용자 선택: 그대로 결제 진행
                │
                ▼

[4] 멤버십 할인 선택 단계
    - 멤버십 선택은 필수이므로 선택값이 없으면 409 반환(롤백)
        │
        ├─ ❌ 선택하지 않음 → 다시 선택 요청
        │
        └─ ⭕ 멤버십 적용 선택
                │
                ▼

[5] 모든 선택 완료 → 최종 결제가 실행되고 영수증 출력.

```

## 🧾 5. 영수증

### 📋 영수증 구성 항목

- 아래 항목들이 모두 포함된다.
  - 구매한 모든 상품 목록
  - 각 상품의 구매 수량과 그 수에 대한 지불 금액
  - 프로모션으로 추가 제공된 증정품 목록
  - 상품별 증정품에 대한 할인된 금액(= 단가 × 증정품 수량)
  - 프로모션 할인 금액 합계
  - 멤버십 할인 금액 (최대 8,000원)
  - 모두 포함한 금액과 할인이 완료된 최종 결제 금액
  
### 🧾 영수증 예시
```
========== 영수증 ==========

콜라 (2개)            3,400원
오렌지주스 (2개)      4,000원
물 (3개)              2,100원
----------------------------

[증정 상품]
콜라 (1개)            1,700원
오렌지주스 (2개)      4,000원
----------------------------

총  구매액            15,200원
행사 할인            -5,700원
멤버십 할인            -210원
----------------------------

최종 결제금액          9,290원
```

## 📌 추가적인 예외사항

- 존재하지 않는 상품 ID
- 유효하지 않은 입력 데이터
- DB와 UI 재고 불일치 상황
- 장바구니가 빈 상황에서 결제 시도한 경우
- 재고를 초과하는 양을 담기 시도하는 경우

## 📌 프로젝트 목표

- **실제 편의점 결제 흐름을 웹에서 구현**
- **사용자 선택에 따른 상태 전이를 명확히 설계**
- **프로모션 및 멤버십 할인 정책을 체계적으로 모델링**
- **DB 기반 재고 관리의 일관성 확보**
- **UI/서버의 역할을 명확히 분리**

## 간단한 주제 선정이유
이번 오픈미션은 프리코스에 진심으로 참여한 사람들의 도전과 배움을 평가에 더 반영하기 위한 것이라고 이해했습니다.
각자가 스스로 정의한 도전에 부딪혀보면서 얼마나 깊이 고민했고 무엇을 배웠는지, 그 과정을 통해 어떤 방향으로
성장해 가고 있는지를 제 스스로 확인하고 다져 가는 것, 그리고 앞으로도 계속 발전할 수 있는 사람이 되는 것이
이 오픈미션에서 제가 가장 중요하게 두는 가치입니다.

저에게 의미 있는 도전이 무엇인지 고민해 봤을 때, 새로운 언어나 도구를 쓰는 것처럼 뭔가 특별한 도전도 색다른 경험으로써
충분히 훌륭한 가치를 얻을 수 있겠지만, 백엔드 개발자 지망생으로서 꼭 필요한 기본기(스프링, DB, 웹 애플리케이션)를
제대로 경험해 보는 것이 먼저라고 판단했습니다. 실제로 스프링과 DB를 활용해 웹 환경에서 돌아가는 무언가를
스스로 설계·구현해 본 경험이 너무 부족했기에 이를 통하여 뭐라도 만들어보자고 생각했습니다. 마침 작년 프리코스의 
편의점 미션을 온전히 완성하지 못했다는 아쉬움이 마음에 항상 있었던 것을 이번 기회에 제대로 풀어보고자 선정하게 되었습니다. 
부족한 만큼 이번 오픈미션을 직접 편의점을 약식으로라도 웹으로 구현해본다면 좋은 공부가 될 것이라고 생각했습니다.
하지만 아무래도 해봤던 것을 발전시키는 것이니 만큼 최대한 요구사항에 대한 반복과 이해없는 수용을 자제하고 틀만 참고하여 
최대한 주도적으로 해보고자 노력했습니다. 즉 “웹 서비스” 수준으로 편의점 결제 구조를 확장·재해석하는 것을 제 도전으로 삼았습니다.

따라서 제가 선택한 방향은 백엔드로 나아가고자 하는 길에서 지금 가장 필요한 것을 더 깊게 공부해보는 것이었습니다.
스스로 웹 어플리케이션을 설계해보고, 도메인과 웹, DB를 엮어내는 기본기를 더욱 깊게 다지기 위한 도전입니다.
실제 서비스 수준보단 한참 모자랄지라도 이 과정을 통해 제가 문제를 분석하고, 설계하고, 시행착오를 겪으며 유의미한 성장
그 자체를 이루는 것이 오픈 미션의 가장 중요한 가치였습니다.